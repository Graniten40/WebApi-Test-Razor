@page
@model AppRazor.Pages.FriendsByLocation.IndexModel

@{
    ViewData["Title"] = "Friends by Location";
}

<h1>Friends – Country and/or City</h1>

@* GET-formulär för filtrering på Country och/eller City.
   Eftersom method="get" används hamnar värdena i querystring,
   vilket gör sidan bokmärkningsbar och lätt att dela. *@
<form method="get" class="row g-2 align-items-end mb-3">
    <div class="col-md-4">
        <label class="form-label">Country</label>
        <input class="form-control"
               name="Country"
               value="@Model.Country"
               placeholder="e.g. Sweden" />
    </div>

    <div class="col-md-4">
        <label class="form-label">City</label>
        <input class="form-control"
               name="City"
               value="@Model.City"
               placeholder="e.g. Gävle" />
    </div>

    <div class="col-md-4">
        @* Submit kör ny GET med filter i querystring *@
        <button class="btn btn-primary me-2" type="submit">Search</button>

        @* Clear länkar till sidan utan querystring → nollställer filtren *@
        <a class="btn btn-outline-secondary" asp-page="/FriendsByLocation/Index">Clear</a>
    </div>
</form>

@* Guard rendering:
   1) Visa fel om ErrorMessage finns
   2) Visa resultat om minst ett filter är angivet
   3) Annars visa instruktion till användaren *@
@if (Model.ErrorMessage != null)
{
    <div class="alert alert-danger">@Model.ErrorMessage</div>
}
else if (!string.IsNullOrWhiteSpace(Model.Country) || !string.IsNullOrWhiteSpace(Model.City))
{
    @* Visar aktiva filter + antal träffar *@
    <p class="text-muted">
        Showing results for
        @if (!string.IsNullOrWhiteSpace(Model.Country))
        {
            <strong>Country:</strong> @Model.Country
        }
        @if (!string.IsNullOrWhiteSpace(Model.City))
        {
            <span class="ms-2"><strong>City:</strong> @Model.City</span>
        }
        <span class="ms-2">(<strong>@Model.Friends.Count</strong> friends)</span>
    </p>

    @* Om det finns träffar: rendera tabell *@
    @if (Model.Friends.Any())
    {
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Country</th>
                    <th>City</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var f in Model.Friends)
            {
                <tr>
                    @* Trim används för att undvika extra mellanslag om något namn saknas *@
                    <td>@($"{f.FirstName} {f.LastName}".Trim())</td>
                    <td>@f.Email</td>
                    <td>@f.Country</td>
                    <td>@f.City</td>
                </tr>
            }
            </tbody>
        </table>
    }
    else
    {
        @* Inga träffar trots filter *@
        <div class="alert alert-warning">No friends found for selected filters.</div>
    }
}
else
{
    @* Startläge: inga filter angivna *@
    <div class="alert alert-info">
        Enter a country and/or city to list friends.
    </div>
}
