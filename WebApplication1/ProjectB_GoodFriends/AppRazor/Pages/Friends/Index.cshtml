@page
@model AppRazor.Pages.Friends.IndexModel

@{
    ViewData["Title"] = "Friends";
}

<h2>Friends</h2>

@* GET-formulär för sök/filter.
   Eftersom method="get" hamnar parametern i querystring (bra för paging + delbar URL). *@
<form method="get" class="row g-2 align-items-end">
    <div class="col-md-8">
        <label class="form-label">Search</label>

        @* OBS: I din PageModel används parametern "country" som en generell filter-sträng
           (för att söka på name/email), inte som land i adress.
           Vi behåller namnet för kompatibilitet med PageModel/querystring. *@
        <input class="form-control"
               name="country"
               value="@Model.Country"
               placeholder="Search by name or email (e.g. Ron, gmail)" />

        <div class="form-text">
            Search matches <strong>name</strong> and <strong>email</strong> (not country/city).
        </div>
    </div>

    <div class="col-md-4">
        @* Submit kör en ny GET med querystring (country=...) *@
        <button class="btn btn-primary me-2" type="submit">Search</button>

        @* Clear navigerar till sidan utan querystring → reset av filter/paging *@
        <a class="btn btn-outline-secondary" asp-page="/Friends/Index">Clear</a>
    </div>
</form>

<hr />

@* Guard rendering:
   - Om ErrorMessage finns: visa fel
   - Om inga resultat: visa "No friends found"
   - Annars: rendera tabell + paging *@
@if (!string.IsNullOrWhiteSpace(Model.ErrorMessage))
{
    <div class="alert alert-danger">@Model.ErrorMessage</div>
}
else if (Model.Result?.Items == null || Model.Result.Items.Count == 0)
{
    <div class="alert alert-warning">No friends found.</div>
}
else
{
    @* Visar resultatinfo och aktuell sida (PageNr är 0-baserad i DTO) *@
    <p>
        <strong>Results:</strong> @Model.Result.Items.Count
        <span class="text-muted">
            (page @(Model.Result.PageNr + 1) of @(Math.Max(1, Model.Result.TotalPages)))
        </span>
    </p>

    @* Tabell med listade friends. "Details" länkar vidare till details-sidan via friendId. *@
    <table class="table table-striped align-middle">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Seeded</th>
                <th class="text-end"></th>
            </tr>
        </thead>
        <tbody>
        @foreach (var f in Model.Result.Items)
        {
            <tr>
                <td>@f.FullName</td>
                <td>@f.Email</td>
                <td>@f.Seeded</td>
                <td class="text-end">
                    <a class="btn btn-sm btn-outline-primary"
                       asp-page="/Friends/Details/Index"
                       asp-route-friendId="@f.FriendId">
                        Details
                    </a>
                </td>
            </tr>
        }
        </tbody>
    </table>

    @* Paging: Prev/Next länkar skickar med pageNr och behåller söksträngen (country)
       så att filter inte tappas när man bläddrar. *@
    <div class="d-flex gap-2">
        @if (Model.Result.PageNr > 0)
        {
            <a class="btn btn-outline-secondary"
               asp-page="/Friends/Index"
               asp-route-pageNr="@(Model.Result.PageNr - 1)"
               asp-route-country="@Model.Country">
                Prev
            </a>
        }

        @if (Model.Result.PageNr + 1 < Model.Result.TotalPages)
        {
            <a class="btn btn-outline-secondary"
               asp-page="/Friends/Index"
               asp-route-pageNr="@(Model.Result.PageNr + 1)"
               asp-route-country="@Model.Country">
                Next
            </a>
        }
    </div>
}
