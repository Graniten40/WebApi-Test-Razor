@page
@model AppRazor.Pages.Overview.IndexModel

@{
    ViewData["Title"] = "Overview";
}

<h1>Overview – Friends by Country</h1>

@* Visar felmeddelande om något gick fel vid laddning av data *@
@if (Model.ErrorMessage != null)
{
    <div class="alert alert-danger">@Model.ErrorMessage</div>
}
else
{
    <!-- ===================== -->
    <!-- SUMMARY BY COUNTRY -->
    <!-- ===================== -->

    @* Översikt per land:
       - Totalt antal friends
       - Antal unika städer
       - Länk för att visa city-detaljer för valt land *@
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Country</th>
                <th>Total friends</th>
                <th>Cities</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
        @foreach (var row in Model.Summary)
        {
            <tr>
                <td>@row.Country</td>
                <td>@row.TotalFriends</td>
                <td>@row.Cities</td>
                <td>
                    @* Samma sida används, men med country i querystring
                       → triggar visning av city-detaljer längre ner *@
                    <a class="btn btn-sm btn-outline-primary"
                       asp-page="/Overview/Index"
                       asp-route-country="@row.Country">
                        View cities
                    </a>
                </td>
            </tr>
        }
        </tbody>
    </table>

    <!-- ===================== -->
    <!-- FRIENDS + PETS BY CITY -->
    <!-- ===================== -->

    @* Denna sektion visas endast om ett land är valt *@
    @if (!string.IsNullOrWhiteSpace(Model.Country))
    {
        <hr />
        <h2>
            Friends & Pets in cities of
            <span class="text-primary">@Model.Country</span>
        </h2>

        @if (Model.Cities.Any())
        {
            @* Sammanfattning per stad inom valt land *@
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>City</th>
                        <th>Friends</th>
                        <th>Pets</th>
                    </tr>
                </thead>
                <tbody>
                @foreach (var row in Model.Cities)
                {
                    <tr>
                        <td>@row.City</td>
                        <td>@row.FriendsCount</td>
                        <td>@row.PetsCount</td>
                    </tr>
                }
                </tbody>
            </table>
        }
        else
        {
            @* Inga city-detaljer hittades för valt land *@
            <div class="alert alert-warning">
                No city data found for selected country.
            </div>
        }
    }

    <hr />

    <!-- ===================== -->
    <!-- DETAILS: COUNTRY + CITY -->
    <!-- ===================== -->

    @* Fullständig detaljvy:
       visar alla kombinationer av land + stad med antal friends *@
    <h2>Details – Country + City</h2>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>Country</th>
                <th>City</th>
                <th>NrFriends</th>
            </tr>
        </thead>
        <tbody>
        @foreach (var row in Model.Details)
        {
            <tr>
                <td>@row.Country</td>
                <td>@row.City</td>
                <td>@row.NrFriends</td>
            </tr>
        }
        </tbody>
    </table>
}
